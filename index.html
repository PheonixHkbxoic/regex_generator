<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vyvyan</title>
    <link type="image/x-icon" rel="shortcut icon" href="http://pheker.cn/ssm/static/Vyvyan.png" />
    <link rel="stylesheet" href="css/index.css" />
</head>
<body>
    <div class="condition">
        <h1>Vyvyan</h1><label id="author">by cn.pheker</label>
        <div class="tools">
            <div class="language">
                <label>语言:</label>
                <select id="language_select">
                    <option value="c/c++">c/c++</option>
                    <option value="java">java</option>
                    <option value="php">php</option>
                    <option value="js">js</option>
                    <option value="python">python</option>
                    <option value="ruby">ruby</option>
                </select>
            </div>
            <div class="constant">
                <label>常量:</label>
                <input type="text" id="txt_constant" placeholder="请输入正则常量">
            </div>
        </div>

        <div class="io add-border-top-green">
            <div class="io-item" style="width:30%;">
                <h3>正确实例</h3>
                <textarea id="txt_right" class="border"  placeholder="请输入正确的正则例子"></textarea>
            </div>
            <div class="io-item" style="width:30%;">
                <h3>错误实例</h3>
                <textarea id="txt_error" placeholder="请输入错误的正则例子"></textarea>
            </div>
            <div class="io-item" style="width:30%;">
                <h3 id="start_generate">生成正则</h3>
                <textarea id="txt_regex" rows="20" cols="30" placeholder="这里将显示生成的正则表达式" onpropertychange="this.style.posHeight=this.scrollHeight"></textarea>
            </div>
        </div>

        <!-- 正则功能区 -->
        <div class="function add-border-top-green">
            <div class="io-item" style="width:20%;">
                <h3>匹配</h3>
                <textarea id="txt_test" placeholder="待开发"></textarea>
            </div>
            <div class="io-item" style="width:20%;">
                <h3>替换</h3>
                <textarea id="txt_replace" placeholder="待开发"></textarea>
            </div>
            <div class="io-item" style="width:20%;">
                <h3>转换</h3>
                <textarea id="txt_convert" placeholder="待开发" onpropertychange="this.style.posHeight=this.scrollHeight"></textarea>
            </div>
            <div class="io-item" style="width:20%;">
                <h3>库</h3>
                <textarea id="txt_convert" placeholder="待开发" onpropertychange="this.style.posHeight=this.scrollHeight"></textarea>
            </div>
        </div>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.2.0/jquery.js"></script>
    <script src="js/util_pheker.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">

        var vars = pheker;
        $(document).ready(function(){

        //change
        //工具区
            //语言
            $("#language_select").change(function() {
                $("#language_select option:selected").each(function () {
                    vars.tools[0] = $(this).text();
                    dealText();
                });
            })
            $("#txt_constant").on('input propertychange',function(){
                var text = $(this).val();
                vars.tools[1] = text?text.split("##"):[];
                dealText();
            })

            //正确实例,错误实例
            $.each(vars.ids,function(index,id){
                var ta = $("#"+id);
                ta.on('input propertychange',function(){
                    vars.txts[index] = ta.val();
                    dealText();
                })
            })
            //生成正则按钮
            $("#start_generate").click(function(){
                dealText();
            })

            //逻辑处理
            function dealText(tools,txts){
                //获取语言,常量,正确实例,错误实例,
                vars.tools[0] = $("#language_select option:selected").text();
                vars.tools[1] = $("#txt_constant").val();
                vars.txts[0] = $("#txt_right").val();
                vars.txts[1] = $("#txt_right").val();
                console.log(vars);

                var constant = vars.tools[1];
                var regex = constant;

                vars.regexs[0] = regex;

            //没有考虑常量的情况下
                //正确实例字符数组
                var reg_example_rights = vars.txts[0]?vars.txts[0].split("\n"):[];
                // console.log(reg_example_rights)
                //重构数组为 按索引划分的数组
                var arrAtIndex = pheker.toArrByIndex(reg_example_rights);
                // console.log(arrAtIndex)
                //每个索引位置 生成各自 正则数组
                var regArr = []; //生成的正则字符数组 二维
                arrAtIndex.forEach(function(v,i,rer){
                    var uniqueArr = pheker.uniqueStr(v).split("");
                    // console.log(uniqueArr);
                    regArr.push(pheker.generateRegArrAtIndex(uniqueArr));
                });
                // console.log(regArr);

                //组合正则
                var assembledArr = pheker.assembleRegArr(regArr);
                console.log(assembledArr);
                //优化正则
                    var optimizedArr = pheker.noRepeat(assembledArr);

                //显示正则
                // $("#txt_regex").val(vars.regexs.join("\n"));
                 $("#txt_regex").val(assembledArr.join("\n"));

            }
        });


    </script>
</body>
</html>
